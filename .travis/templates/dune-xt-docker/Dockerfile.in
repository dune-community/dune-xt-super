FROM dunecommunity/testing-base:master

# ****** THIS FILE IS AUTOGENERATED, DO NOT EDIT **********

RUN git clone --branch=${branch} https://github.com/dune-community/dune-xt-super.git ${SUPERDIR} && \
    cd ${SUPERDIR} && \
    git submodule foreach git reset --hard && \
    git submodule update --init --recursive && \
    git submodule status
WORKDIR ${SUPERDIR}

ENV CC=${cc} \
    CXX=${cxx} \
    GCOV=/usr/bin/gcov \
    MY_MODULE=${project_name} \
    OPTS=config.opts/travis.ninja \
    BUILD_CMD="ninja -k 10000 -j 2" \
    PATH=/usr/lib/ccache:${PATH} \
    SRC_DCTRL=${SUPERDIR}/dune-common/bin/dunecontrol

# run our local scripts look for an OPTS env entry
# and ensure ${MY_MODULE} from checkout is used via clean mount point
# and removes xt-la, xt-grid, xt-functions for xt-common, etc
RUN ${DUNE_VENV_ACTIVATE} && \
    ./local/bin/download_external_libraries.py 1> /dev/null && \
    CXX=g++ ./local/bin/build_external_libraries.py 1> /dev/null && \
    rm -rf ${MY_MODULE} ${modules_to_delete} ${extra_deletes} && \
    mkdir ${MY_MODULE} && \
    ${SRC_DCTRL} ${BLD} all

# THE END
ENV DEBIAN_FRONTEND teletype


# ****** THIS FILE IS AUTOGENERATED, DO NOT EDIT **********
